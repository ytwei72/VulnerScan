package com.dky.vulnerscan.module;

import com.dky.vulnerscan.util.LogUtil;
import com.dky.vulnerscan.web.listener.StartMsfRpcListener;
import org.springframework.web.context.ContextLoader;
import org.springframework.web.context.WebApplicationContext;

import java.io.IOException;

/**
 * Created by bo on 2016/12/27.
 */
public class ExploitScanErrorThread extends Thread {
    private int projectID;
    private int taskID;
    private String ip;
    private boolean exit = false;
    private WebApplicationContext context = ContextLoader.getCurrentWebApplicationContext();
    private ExploitScanModule exploitScanModule = (ExploitScanModule) context.getBean("ExploitScanModule");

    public void setExit(boolean exit) {
        this.exit = exit;
    }

    public ExploitScanErrorThread(int projectID, int taskID, String ip) {
        this.projectID = projectID;
        this.taskID = taskID;
        this.ip = ip;
    }

    @Override
    public void run() {
        while (!exit) {
            try {
                String error = StartMsfRpcListener.getBe().readLine();
                LogUtil.deepScanLog("exploit error: " + projectID + "," + taskID + "," + ip + ":" + error);
            } catch (IOException e1) {
                e1.printStackTrace();
            }
        }
        exploitScanModule.setExploitScanErrorThread(null);
    }
}
